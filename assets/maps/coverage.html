<!DOCTYPE html>
<html>
<head>
    <style>
        /* Optional: Makes the sample page fill the window. */
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
        }
        th, td {
            padding-left: 10px;
            text-align: left;
        }
        /* Always set the map height explicitly to define the size of the div
         * element that contains the map. */
        #map {
            height: 100%;
        }
        #legend {
            font-family: Arial, sans-serif;
            font-size: 120%;
            background: #ffffff;
            padding: 10px;
            margin: 10px;
            border: 2px solid #555555;
        }
    </style>
</head>
<body>
<div id="map"></div>
<div id="legend">
    <table>
        <tr>
            <th>Color</th>
            <th>SF</th>
        </tr>
        <tr>
            <td bgcolor="#ff0000"></td>
            <td>SF7</td>
        </tr>
        <tr>
            <td bgcolor="#ff8000"></td>
            <td>SF8</td>
        </tr>
        <tr>
            <td bgcolor="#ffff00"></td>
            <td>SF9</td>
        </tr>
        <tr>
            <td bgcolor="#40ff00"></td>
            <td>SF10</td>
        </tr>
        <tr>
            <td bgcolor="#00ffff"></td>
            <td>SF11</td>
        </tr>
        <tr>
            <td bgcolor="#0000ff"></td>
            <td>SF12</td>
        </tr>
        <tr>
            <td bgcolor="#808080"></td>
            <td>Error</td>
        </tr>
    </table>
</div>
<script>
    var map;
    function initMap() {
        var gatewayHome = {lat: 51.001811, lng: 4.713596};
        var gatewayKUL = {lat:50.862279, lng: 4.685495};

        map = new google.maps.Map(document.getElementById('map'), {
            zoom: 16,
            center: gatewayKUL,
            // mapTypeId: 'hybrid'
        });

        var markerHome = new google.maps.Marker({
            position: gatewayHome,
            map: map,
            title: 'Gateway: 008000000000b88d',
            label: 'G',
            zIndex: 7,
        });

        var markerKUL = new google.maps.Marker({
            position: gatewayKUL,
            map: map,
            title: 'Gateway: e4a7a0ffffd4bbaa',
            label: 'G',
            zIndex: 7,
        });

        var legend = document.getElementById('legend');
        map.controls[google.maps.ControlPosition.LEFT_BOTTOM].push(legend);

        // Create a <script> tag and set the USGS URL as the source.
        var script = document.createElement('script');

        // This example uses a local copy of the GeoJSON stored at
        // http://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/2.5_week.geojsonp
        script.src = 'https://hooked.duckdns.org/lora/geojson/all?callback=eqfeed_callback';
        document.getElementsByTagName('head')[0].appendChild(script);
    }

    function eqfeed_callback(results) {
        for (var i = 0; i < results.features.length; i++) {
            var coords = results.features[i].geometry.coordinates;
            var latLng = new google.maps.LatLng(coords[0], coords[1]);
            var colorAndIndex = getColorAndIndex(results.features[i].properties.sf);
            var circle = new google.maps.Circle({
                center: latLng,
                fillColor: colorAndIndex[0],
                fillOpacity: 1,
                map: map,
                radius: 5,
                strokeColor: colorAndIndex[0],
                strokeOpacity: 0.25,
                strokeWeight: 25,
                zIndex: colorAndIndex[1],
            });
        }
    }

    function getColorAndIndex(sf) {
        var color;
        var index;
        switch(sf) {
            case "sf7":
                color = "#ff0000";
                index = 6;
                break;
            case "sf8":
                color = "#ff8000";
                index = 5;
                break;
            case "sf9":
                color = "#ffff00";
                index = 4;
                break;
            case "sf10":
                color = "#40ff00";
                index = 3;
                break;
            case "sf11":
                color = "#00ffff";
                index = 2;
                break;
            case "sf12":
                color = "#0000ff";
                index = 1;
                break;
            default:
                color = "#808080";
                index = 0;
        }
        return [color, index];
    }
</script>
<script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyATGmbSfdpAzu6MfldU8mrrABmE059XGCs&libraries=visualization&callback=initMap">
</script>
</body>
</html>
